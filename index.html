<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>腾讯天气</title>
  <meta name="description" content="腾讯天气">
  <link rel="stylesheet" href="./index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/qweather-icons@1.8.0/font/qweather-icons.css">
  <script src="./echarts.js"></script>
</head>

<body>
  <div>
    <div id="header">
      <div class="container">
        <img src="./imgs/logo.png" alt="logo" id="logo">
        <div id="imgslocation">
          <a href="https://www.qq.com/" style="color: #fff;margin-right: 20px;">腾讯网首页</a>
          <a href="javascript:void(0)" onclick="window.aria.start()" style="color: #fff;margin-right: 20px;">无障碍浏览</a>
          <script>
            // 检查用户登录状态
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
              document.write('<span style="color: #fff;margin-right: 20px;">欢迎，' + currentUser + '</span>');
              document.write('<a href="javascript:void(0)" onclick="logout()" style="color: #fff;margin-right: 20px;">退出</a>');
            } else {
              document.write('<a href="login.html" style="color: #fff;margin-right: 20px;">登录</a>');
              document.write('<a href="register.html" style="color: #fff;margin-right: 20px;">注册</a>');
            }
          </script>
          <script>
            // 退出登录函数
            function logout() {
              localStorage.removeItem('currentUser');
              alert('已退出登录');
              window.location.reload();
            }
          </script>
          <div id="imgsshow">
            <p id="txt-cur-location" class="position">陕西-西安</p>
            <div id="imgsattention">
              <h3 id="titl">关注的城市</h3>
              <ol id="ls-attention">
                <li id="tips-attention">点击“添加关注”添加城市哟~</li>
              </ol>
            </div>
          </div>
          <a href="javascript:;" id="btn-attention" style="display: inline-block;">[添加关注]</a>
          <div id="imgssearch">
            <input type="input" id="location" placeholder="搜索市、区、县等">
            <ul id="ls-match">
              <li class="match">陕西-西安</li>
            </ul>
            <div id="hot-city">
              <div id="history">
                <p class="tit">历史记录</p>
                <a id="btn-clean">清除</a>
                <ul class="ls-city" id="ls-history">
                </ul>
              </div>
              <p class="tit">热门城市</p>
              <ul id="ls-hot-city" class="ls-city">
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="imgscurrent">
      <div class="container">
      </div>
    </div>
    <div class="container" id="imgshours">
      <h2 id="title">逐小时预报</h2>
      <a id="txt-source" href="http://www.weather.com.cn/" target="_blank">数据来源于中国天气网</a>
      <div class="imgspage-ctrl">
        <a href="javascript:;" id="btn-prev" class="btn btn-time-prev"></a>
        <a href="javascript:;" id="btn-next" class="btn btn-time-next"></a>
      </div>
      <div id="imgsweather">
        <ol id="ls-weather-hour" class="ls-weather">

        </ol>
      </div>
    </div>
    <div class="container" style="margin-bottom: 35px;">
      <div id="imgs7-days">
        <a id="link-15" href="http://www.weather.com.cn/weather15d/101110101.shtml" target="_blank">15日天气预报</a>
        <h2 id="title">7日天气预报</h2>
        <div id="imgsweather" class="box-content">
          <ol id="ls-weather-day" class="ls-weather">
          </ol>
          <div id="chart-days" _echarts_instance_="ec_1755348201621"
            style="-webkit-tap-highlight-color: transparent; user-select: none; background: rgba(0, 0, 0, 0);">
            <div
              style="position: relative; overflow: hidden; width: 740px; height: 174px; padding: 0px; margin: 0px; border-width: 0px;">
              <canvas width="1480" height="348" data-zr-dom-id="zr_0"
                style="position: absolute; left: 0px; top: 0px; width: 740px; height: 174px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div id="imgsliving-index">
        <div class="imgspage-ctrl">
          <a href="javascript:;" id="btn-prev" class="btn btn-living-prev"></a>
          <a href="javascript:;" id="btn-next" class="btn btn-living-next"></a>
        </div>
        <h2 id="title">生活指数</h2>
        <div id="imgspages">
          <div id="imgscontent">
            <ul id="ls-living1" class="page">
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_chuanyi_shushi"></i>
                  <p class="content">穿衣&nbsp;舒适</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">建议着长袖T恤、衬衫加单裤等服装。年老体弱者宜着针织长袖衬衫、马甲和长裤。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_yusan"></i>
                  <p class="content">雨伞&nbsp;不带伞</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">阴天，但降水概率很低，因此您在出门的时候无须带雨伞。</div>
                </div>
              </li>
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_ganmao"></i>
                  <p class="content">感冒&nbsp;较易发</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">天气转凉，空气湿度较大，较易发生感冒，体质较弱的朋友请注意适当防护。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_xiche"></i>
                  <p class="content">洗车&nbsp;不适宜</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">将有降水，不宜洗车。</div>
                </div>
              </li>
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_yundong"></i>
                  <p class="content">运动&nbsp;适宜</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">天气较好，赶快投身大自然参与户外运动，尽情感受运动的快乐吧。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_fangsai"></i>
                  <p class="content">防晒&nbsp;弱</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">属弱紫外辐射天气，长期在户外，建议涂擦SPF在8-12之间的防晒护肤品。</div>
                </div>
              </li>
            </ul>
            <ul id="ls-living1" class="page">
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_diaoyu"></i>
                  <p class="content">钓鱼&nbsp;不宜</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">天气不好，不适合垂钓。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_lvyou"></i>
                  <p class="content">旅游&nbsp;适宜</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">温度适宜，又有较弱降水和微风作伴，会给您的旅行带来意想不到的景象，适宜旅游，可不要错过机会呦！</div>
                </div>
              </li>
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_jiaotong"></i>
                  <p class="content">交通&nbsp;一般</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">有降水，路面湿滑，刹车距离延长，事故易发期，注意车距，务必小心驾驶。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_wurankuosan"></i>
                  <p class="content">空气污染扩散条件&nbsp;良</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">气象条件有利于空气污染物稀释、扩散和清除。</div>
                </div>
              </li>
              <li class="item odd">
                <div class="imgssub"> <i class="icon icon_shushidu"></i>
                  <p class="content">舒适度&nbsp;舒适</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">白天温度适宜，风力不大，相信您在这样的天气条件下，应会感到比较清爽和舒适。</div>
                </div>
              </li>
              <li class="item even">
                <div class="imgssub"> <i class="icon icon_liangshai"></i>
                  <p class="content">晾晒&nbsp;不宜</p>
                </div>
                <div class="imgsdetail">
                  <div class="detail">有降水，不适宜晾晒。若需要晾晒，请在室内准备出充足的空间。</div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id="imgsfooter">
      <div id="imgssponsors">
        <a href="http://www.cma.gov.cn/" target="_blank"><img src="./imgs/1.png"></a>
        <a href="http://www.nmc.cn/" target="_blank"><img src="./imgs/2.png"></a>
        <a href="http://www.weather.com.cn/" target="_blank"><img src="./imgs/3.png"></a>
      </div>
      <div id="tcopyright" class="tcopyright" bosszone="footer" role="contentinfo">
        <div><a href="http://www.tencent.com/" target="_blank" rel="nofollow">关于腾讯</a> | <a
            href="http://www.tencent.com/index_e.shtml" target="_blank" rel="nofollow">About Tencent</a> | <a
            href="http://new.qq.com/static/contract.shtml" target="_blank" rel="nofollow">服务协议</a> | <a
            href="https://privacy.qq.com/mb/policy/tencent-privacypolicy" target="_blank" rel="nofollow">隐私政策</a> | <a
            href="http://open.qq.com/" target="_blank" rel="nofollow">开放平台</a> | <a href="http://www.tencentmind.com/"
            target="_blank" rel="nofollow">广告服务</a> | <a href="http://hr.tencent.com/" target="_blank"
            rel="nofollow">腾讯招聘</a> | <a href="http://gongyi.qq.com/" target="_blank" rel="nofollow">腾讯公益</a></div>
        <div class="en">Copyright © 1998 - 2025 Tencent. All Rights Reserved</div>
        <div><a href="http://www.tencent.com/" target="_blank" rel="nofollow">腾讯公司</a> <a
            href="http://www.tencent.com/zh-cn/le/copyrightstatement.shtml" target="_blank" rel="nofollow">版权所有</a>
        </div>
      </div>
    </div>
  </div>
</body>
<script>

  // fetch(`https://mj4y3jgbfa.re.qweatherapi.com/geo/v2/city/lookup?location=西安`, {
  //   method: "GET",
  //   headers: {
  //     "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
  //   }
  // }).then(res => res.json()).then(data => {
  //   console.log(123456, data)
  // })


  const cityInfo = [
    {
      name: "北京",
      id: "101010100"
    },
    {
      name: "上海",
      id: "101020100"
    },
    {
      name: "西安",
      id: "101110101"
    },
    {
      name: "深圳",
      id: "101280601"
    },
    {
      name: "广州",
      id: "101280101"
    },
    {
      name: "武汉",
      id: "101200101"
    },
    {
      name: "成都",
      id: "101270101"
    },
    {
      name: "石家庄",
      id: "101090101"
    },
    {
      name: "郑州",
      id: "101180101"
    },
    {
      name: "哈尔滨",
      id: "101050101"
    },
    {
      name: "厦门",
      id: "101230201"
    },
    {
      name: "天津",
      id: "101030100"
    }, {
      name: "秦皇岛",
      id: "101091101"
    }, {
      name: "长安",
      id: "101110102"
    }, {
      name: "咸阳",
      id: "101110200"
    }, {
      name: "唐山",
      id: "101090501"
    }, {
      name: "杭州",
      id: "101210101"
    }, {
      name: "济南",
      id: "101120101"
    }, {
      name: "青岛",
      id: "101120201"
    }, {
      name: "烟台",
      id: "101120501"
    }, {
      name: "桂林",
      id: "101300501"
    }, {
      name: "宝鸡",
      id: "101110901"
    }, {
      name: "北海",
      id: "101301301"
    }, {
      name: "丽江",
      id: "101291401"
    }, {
      name: "大理",
      id: "101290201"
    }, {
      name: "海口",
      id: "101310101"
    }, {
      name: "重庆",
      id: "101040100"
    }, {
      name: "合肥",
      id: "101220101"
    }
  ]

  // 实现ls-history功能 点击或者搜索的要加到这里面
  //你应该维护一个变量 在写一个渲染函数 每次操作后调用

  let historyList = []
  const lh = document.getElementById("ls-history")

  // 渲染函数
  function renderHistory() {
    let html = ""
    for (const element of historyList) {
      html += `<li class="opts"><span class="hot_match" data-id="${element.id}">${element.name}</span></li>`
    }
    lh.innerHTML = html
  }

  // 点击清除按钮，清除历史记录
  const btnClean = document.getElementById("btn-clean")
  btnClean.addEventListener("click", () => {
    historyList = []
    renderHistory()
  })

  const lsHistory = document.getElementById("ls-hot-city")
  let lihtml = ``;
  for (const element of cityInfo) {
    lihtml += `<li class="opts"><span class="hot_match" data-id="${element.id}">${element.name}</span></li>`
  }
  lsHistory.innerHTML = lihtml


  function change(e) {
    if (e.target.classList.contains("hot_match")) {
      // locationdom.value = e.target.innerHTML
      const curlocation = document.getElementById("txt-cur-location")
      curlocation.innerText = e.target.innerHTML
      console.log(2222, list, e.target.innerHTML);

      btnAttention.innerText = list.find(item => item.name === e.target.innerHTML) ? "取消关注" : "添加关注"

      domMatch.style.display = "none"
      const id = e.target.dataset.id
      // 点击热门城市，将热门城市的值赋值给input框
      historyList.push({
        name: e.target.innerHTML,
        id: id
      })
      renderHistory()
      getHistory(id)
      xiaoshi(id)
      now(id)
    }
  }


  lsHistory.addEventListener("click", change)
  lh.addEventListener("click", change)

  document.addEventListener("click", (e) => {
    if (e.target.id !== "location" && e.target.id !== "ls-match" && e.target.id !== "hot-city") {
      const hotCity = document.getElementById("hot-city")
      hotCity.style.display = "none"
      const domMatch = document.getElementById("ls-match")
      domMatch.style.display = "none"
    }
  })

  // 基于 cityInfo 实现 id=location 的input框模糊搜索功能
  const locationdom = document.getElementById("location")
  locationdom.onfocus = () => {
    const hotCity = document.getElementById("hot-city")
    hotCity.style.display = "block"
  }

  locationdom.onblur = () => {
    // 清空输入框
    locationdom.value = ""
  }

  locationdom.addEventListener("input", (e) => {
    const domMatch = document.getElementById("ls-match")
    const hotCity = document.getElementById("hot-city")

    const value = e.target.value
    if (value === "") {
      domMatch.style.display = "none"
      hotCity.style.display = "block"
      return
    }
    const res = cityInfo.filter(item => item.name.includes(value))
    let html = ""
    for (let index = 0; index < res.length; index++) {
      const element = res[index];
      html += `<li class="match" data-id="${element.id}">${element.name}</li>`
    }
    domMatch.innerHTML = html
    // 显示domMatch元素
    domMatch.style.display = "block"
    hotCity.style.display = "none"
    console.log(111, res)
  })


  let list = []


  // 点击匹配项，将匹配项的值赋值给input框
  //  用事件委托
  const domMatch = document.getElementById("ls-match")
  domMatch.addEventListener("click", (e) => {
    if (e.target.classList.contains("match")) {
      // locationdom.value = e.target.innerHTML
      const curlocation = document.getElementById("txt-cur-location")
      curlocation.innerText = e.target.innerHTML
      console.log(2222, list, e.target.innerHTML);

      btnAttention.innerText = list.find(item => item.name === e.target.innerHTML) ? "取消关注" : "添加关注"

      domMatch.style.display = "none"
      const id = e.target.dataset.id
      // 点击匹配项，将匹配项的值赋值给input框
      historyList.push({
        name: e.target.innerHTML,
        id: id
      })
      renderHistory()
      getHistory(id)
      xiaoshi(id)
      now(id)
    }
  })

  // 添加 btn-attention 添加关注 把当前城市添加到关注列表
  const btnAttention = document.getElementById("btn-attention")
  // 存储默认城市
  let defaultCity = localStorage.getItem('defaultCity') || '西安';

  // 初始化默认城市显示
  const curlocation = document.getElementById("txt-cur-location")
  curlocation.innerText = defaultCity;

  btnAttention.addEventListener("click", (e) => {
    const curlocationText = curlocation.innerText
    const res = list.find(item => item.name === curlocationText)
    if (res) {
      btnAttention.innerText = "添加关注"
      list = list.filter(item => item.name !== curlocationText)
    } else {
      btnAttention.innerText = "取消关注"
      list.push({
        name: curlocationText,
        isDefault: curlocationText === defaultCity
      })
    }
    renderAttentionList();
  })

  // 渲染关注列表函数
  function renderAttentionList() {
    const dom = document.getElementById("ls-attention")
    let html = ""
    console.log(344444, list, cityInfo);

    for (let index = 0; index < list.length; index++) {
      const element = list[index];
      const isDefault = element.name === defaultCity;
      html += `<li class="city">
        <p class="city-name">${element.name}
          ${isDefault ? ' <span class="default-tag">默认</span>' : ''}
          <span class="set-default" data-name="${element.name}">${isDefault ? '取消默认' : '设为默认'}</span>
          </p>
        <span class="current-weather" data-name="${element.name}" data-id="${cityInfo.find(item => item.name === element.name)?.id || ''}">加载中...</span>
        <span class="current-wendu" data-name="${element.name}" data-id="${cityInfo.find(item => item.name === element.name)?.id || ''}">加载中...</span>
        <span class="del">
          <img class='del-image' data-name="${element.name}" src="./imgs/del.png" alt="">
        </span>
      </li>`
    }
    dom.innerHTML = html;

    // 添加鼠标划过效果
    const setDefaultSpans = document.querySelectorAll('.set-default');
    setDefaultSpans.forEach(span => {
      span.addEventListener('mouseover', function () {
        const cityName = this.getAttribute('data-name');
        this.textContent = cityName === defaultCity ? '取消默认' : '设为默认';
      });
    });

    // 添加设为默认点击事件
    setDefaultSpans.forEach(span => {
      span.addEventListener('click', function (e) {
        e.stopPropagation();
        const cityName = this.getAttribute('data-name');
        if (cityName === defaultCity) {
          // 取消默认
          defaultCity = '';
          localStorage.removeItem('defaultCity');
        } else {
          // 设为默认
          defaultCity = cityName;
          localStorage.setItem('defaultCity', defaultCity);
          curlocation.innerText = defaultCity;
        }
        renderAttentionList();
      });
    });

    // 更新所有城市的当前天气
    function updateAllCurrentWeather() {
      const currentWeatherSpans = document.querySelectorAll('.current-weather');
      const wenduSpans = document.querySelectorAll('.current-wendu');

      currentWeatherSpans.forEach((span, index) => {
        const cityId = span.getAttribute('data-id');
        if (cityId) {
          // 使用fetch直接获取天气数据
          fetch(`https://mj4y3jgbfa.re.qweatherapi.com/v7/weather/now?location=${cityId}`, {
            method: "GET",
            headers: {
              "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
            }
          })
            .then(response => response.json())
            .then(data => {
              if (data.code === '200') {
                const weather = data.now;
                console.log(99999, weather);

                span.innerHTML = `
                <i class="icon qi-${weather.icon}-fill"></i>
                ${weather.text}
                `;
                wenduSpans[index].textContent = `${weather.temp}°/${weather.feelsLike}°`;
              } else {
                span.textContent = '获取失败';
              }
            })
            .catch(error => {
              console.error('获取天气数据失败:', error);
              span.textContent = '获取失败';
            });
        }
      });

    }

    // 初始加载所有城市天气
    updateAllCurrentWeather();

    // 添加当前天气点击事件
    const currentWeatherSpans = document.querySelectorAll('.current-weather');
    currentWeatherSpans.forEach(span => {
      span.addEventListener('click', function (e) {
        e.stopPropagation();
        const cityName = this.getAttribute('data-name');
        curlocation.innerText = cityName;
        // 查找城市ID
        const city = cityInfo.find(item => item.name === cityName);
        if (city) {
          getHistory(city.id);
          xiaoshi(city.id);
          now(city.id);
        }
      });
    });
  }

  // 初始化关注列表
  renderAttentionList();

  // 删除关注
  const domAttention = document.getElementById("ls-attention")
  domAttention.addEventListener("click", (e) => {
    if (e.target.classList.contains("del-image")) {
      const cityName = e.target.getAttribute('data-name');
      list = list.filter(item => item.name !== cityName)

      // 如果删除的是默认城市，清除默认设置
      if (cityName === defaultCity) {
        defaultCity = '';
        localStorage.removeItem('defaultCity');
      }
      console.log(4344434343, list);

      renderAttentionList();
      // 取消关注换成添加
      btnAttention.innerText = "添加关注"
    }
  })


  // 历史天气
  async function getHistory(location) {
    const date = new Date()
    const y = date.getFullYear()
    const m = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1
    const d = date.getDate() - 1 < 10 ? "0" + (date.getDate() - 1) : date.getDate() - 1
    const res = await fetch(`https://mj4y3jgbfa.re.qweatherapi.com/v7/historical/weather?location=${location}&date=${y}${m}${d}`, {
      method: "GET",
      headers: {
        "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
      }
    }).then(res => res.json())
    console.log(999, res.weatherDaily)

    // 获取7天天气预报
    const res1 = await fetch(`https://mj4y3jgbfa.re.qweatherapi.com/v7/weather/7d?location=${location}`, {
      method: "GET",
      headers: {
        "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
      }
    }).then(res => res.json())
    const total = [{
      fxDate: res.weatherDaily.date,
      iconDay: res.weatherHourly[0].icon,
      iconNight: res.weatherHourly.at(-1).icon,
      textDay: res.weatherHourly[0].text,
      textNight: res.weatherHourly.at(-1).text,
      windDirNight: res.weatherHourly.at(-1).windDir,
      windDirDay: `${res.weatherHourly[0].windScale}-${res.weatherHourly[0].windSpeed}`,
      windScaleNight: `${res.weatherHourly.at(-1).windScale}-${res.weatherHourly.at(-1).windSpeed}`,
      ...res.weatherDaily
    }, ...res1.daily]
    console.log(555, total)
    const dom7d = document.getElementById("ls-weather-day")
    let html = ""
    for (let index = 0; index < total.length; index++) {
      const element = total[index];
      const date = new Date(element.fxDate)
      const month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1
      const day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate()
      // 后面那个一二三四五六转换不对
      element.fxDate = `${month}月${day}日`
      html += `
            <li class="item ${index === 0 ? "first" : ""}" style="width: 92px">
              <p class="day">
                ${index === 0 ? "昨天" : index === 1 ? "今天" : index === 2 ? "明天" : "周" + "日一二三四五六".charAt(date.getDay())}
              </p>
              <p class="date">${element.fxDate}</p>
              <div class="imgsdaytime">
                <p class="weather">${element.textDay}</p> 
                <i class="icon qi-${element.iconDay}-fill"></i>
              </div>
              <div class="imgsnight"> 
                <i class="icon qi-${element.iconNight}-fill"></i>
                <p class="weather">${element.textNight}</p>
              </div>
              <p class="wind">${element.windDirNight} ${element.windScaleNight}级</p>
      `
    }
    dom7d.innerHTML = html

    const myChart = echarts.init(document.getElementById('chart-days'));
    console.log(33333, myChart);
    // 实现温度折线图
    const chartLabelData = total.map(item => item.fxDate)
    const chartMaxData = total.map(item => item.tempMax)
    const chartMinData = total.map(item => item.tempMin)
    option = {
      backgroundColor: "rgba(0,0,0,0.0)",
      color: ["#FCC370", "#94CCF9"],
      animation: false,
      // renderAsImage: true,
      tooltip: {
        show: false,
      },
      xAxis: [{
        type: 'category',
        show: false,
        data: chartLabelData,
      }],
      yAxis: [{
        type: 'value',
        show: false,
        boundaryGap: ['45%', '45%'],
        scale: true,
      }],
      grid: {
        x: 0,
        y: 0,
        y2: 0,
        height: 174,
        width: 740,
        borderWidth: "0px",
      },
      // legend: {
      //     orient: 'horizontal',
      //     x: 'center',
      //     y: 'top',
      //     itemGap: 55
      // },

      series: [{
        type: 'line',
        data: chartMaxData,
        smooth: true,
        symbol: 'circle',
        symbolSize: 8,
        clipOverflow: false,
        lineStyle: {
          normal: {
            width: 3,
          },
        },
        label: {
          normal: {
            show: true,
            textStyle: {
              fontSize: '18',
              fontFamily: '微软雅黑',
              color: "#384C78",
            },
            distance: 10,
            formatter: function (val) {
              if (val.dataIndex == 0) {
                return `{first|${val.data}°}`;
              };
              return `${val.data}°`;
            },
            rich: {
              first: {
                fontSize: '18',
                fontFamily: '微软雅黑',
                color: "#C2C2C2",
              },
            },
          },
        },
      },
      {
        type: 'line',
        data: chartMinData,
        smooth: true,
        symbol: 'circle',
        symbolSize: 8,
        lineStyle: {
          normal: {
            width: 3,
          },
        },
        label: {
          normal: {
            show: true,
            position: "bottom",
            textStyle: {
              fontSize: '18',
              fontFamily: '微软雅黑',
              color: "#555555",
            },
            distance: 10,
            formatter: function (val) {
              if (val.dataIndex == 0) {
                return `{first|${val.data}°}`;
              };
              return `${val.data}°`;
            },
            rich: {
              first: {
                fontSize: '18',
                fontFamily: '微软雅黑',
                color: "#C2C2C2",
              },
            },
          },
        },
      },
      ],
    };
    myChart.setOption(option);
  }

  getHistory("101110101")
  // 小时
  function xiaoshi(location) {
    fetch(`https://mj4y3jgbfa.re.qweatherapi.com/v7/weather/72h?location=${location}`, {
      method: "GET",
      headers: {
        "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
      }
    }).then(res => res.json()).then(data => {
      const result = data.hourly.slice(0, 24)
      console.log(111, data)

      const h = document.getElementById("ls-weather-hour")
      let html = ""
      result.forEach(item => {
        html += `
         <li class="item">
            <p class="txt-time">${item.fxTime.split("T")[1].split("+")[0]}</p> 
            <i class="icon qi-${item.icon}-fill"></i>
            <p class="txt-degree">${item.temp}°</p>
          </li>
        `
      })
      h.innerHTML = html
    })
  }

  xiaoshi("101110101")

  // 现在天气
  function now(location) {
    // 查找城市名称
    const city = cityInfo.find(item => item.id === location);
    const cityName = city ? city.name : '未知城市';

    fetch(`https://mj4y3jgbfa.re.qweatherapi.com/v7/weather/now?location=${location}`, {
      method: "GET",
      headers: {
        "X-QW-Api-Key": "a61047cd4b504375a4bc461dba98c39c"
      }
    }).then(res => res.json()).then(data => {
      if (data.code !== '200') {
        console.error('获取天气数据失败:', data);
        return;
      }

      console.log(222, data)
      const current = document.getElementById("imgscurrent")
      const html = `
         <div class="container">
        <p id="txt-pub-time">中央气象台${data.updateTime.split('T')[1].split('+')[0]}发布</p>
        <div id="imgsmain">
          <p id="txt-temperature">${data.now.temp}°</p>
          <p id="txt-name">${data.now.text}</p>
          <div id="imgsaqi" class="air-level1">
            <p class="info-aqi">32 优</p>
            <div id="air-window" class="popwindow">
              <div class="header">空气质量指数 32&nbsp;优</div>
              <div class="detail">
                <div class="inner">
                  <table id="tb-detail">
                    <tbody>
                      <tr class="line1">
                        <td>
                          <p class="val">17</p>
                          <p class="titl">PM2.5</p>
                        </td>
                        <td class="nth-2">
                          <p class="val">25</p>
                          <p class="titl">PM10</p>
                        </td>
                        <td>
                          <p class="val">3</p>
                          <p class="titl">SO2</p>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <p class="val">12</p>
                          <p class="titl">NO2</p>
                        </td>
                        <td class="nth-2">
                          <p class="val">102</p>
                          <p class="titl">O3</p>
                        </td>
                        <td>
                          <p class="val">0.6</p>
                          <p class="titl">CO</p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <ul id="ls-warning"></ul>
        </div>
        <div id="imgsother">
          <p class="item">
            <i class="icon wind-4" id="icon-wind"></i>
            <span class="txt" id="txt-wind">${data.now.windDir} ${data.now.windScale}级</span>
          </p>
          <p class="item">
            <i class="icon" id="icon-humidity"></i>
            <span class="txt" id="txt-humidity">湿度 ${data.now.humidity}%</span>
          </p>
          <p class="item">
            <i class="icon" id="icon-kPa"></i>
            <span class="txt" id="txt-kPa">气压 ${data.now.pressure}hPa</span>
          </p>
          <p class="item show" id="info-limit">
            <i class="icon" id="icon-limit"></i>
            <span class="txt" id="txt-limit">能见度 ${data.now.vis}km</span>
          </p>
        </div>
      
        <div id="imgscurrent-weather">
            <i class="big_icon qi-${data.now.icon}-fill"></i>
          </div>
      </div>
      `
      current.innerHTML = html

      // 更新当前城市显示
      curlocation.innerText = cityName;

      // 更新关注按钮状态
      const res = list.find(item => item.name === cityName)
      btnAttention.innerText = res ? "取消关注" : "添加关注";
    }).catch(error => {
      console.error('获取天气数据异常:', error);
    })
  }

  // 初始化默认城市天气
  function initDefaultCityWeather() {
    // 查找默认城市的ID
    const defaultCityObj = cityInfo.find(item => item.name === defaultCity);
    if (defaultCityObj) {
      getHistory(defaultCityObj.id);
      xiaoshi(defaultCityObj.id);
      now(defaultCityObj.id);
    } else {
      // 如果默认城市不在列表中，使用西安
      getHistory("101110101");
      xiaoshi("101110101");
      now("101110101");
    }
  }

  // 初始化天气
  initDefaultCityWeather();

  const btnTimePrev = document.querySelector(".btn-time-prev")
  btnTimePrev.addEventListener("click", () => {
    console.log(111)
    const lsWeatherHour = document.getElementById("ls-weather-hour")
    lsWeatherHour.style.transform = "translateX(0)"
  })

  const btnTimeNext = document.querySelector(".btn-time-next")
  btnTimeNext.addEventListener("click", () => {
    const lsWeatherHour = document.getElementById("ls-weather-hour")
    const itemWidth = lsWeatherHour.offsetWidth
    lsWeatherHour.style.transform = `translateX(-${itemWidth / 4}px)`
  })

  // 做一下btn-living-prev的切换
  const btnLivingPrev = document.querySelector(".btn-living-prev")
  btnLivingPrev.addEventListener("click", () => {
    console.log(111)
    const imgsLiving = document.getElementById("imgscontent")
    imgsLiving.style.transform = "translateX(0)"
  })
  // 做一下btn-living-next的切换
  const btnLivingNext = document.querySelector(".btn-living-next")
  btnLivingNext.addEventListener("click", () => {
    console.log(111)
    const imgsLiving = document.getElementById("imgscontent")
    const itemWidth = imgsLiving.offsetWidth
    imgsLiving.style.transform = `translateX(-${itemWidth / 2}px)`
  })

</script>

</html>